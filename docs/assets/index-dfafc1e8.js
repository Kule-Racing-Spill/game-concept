var q=Object.defineProperty;var F=(a,t,e)=>t in a?q(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var b=(a,t,e)=>(F(a,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();const z=(a,t)=>{const e=a.indexOf(t);e>-1&&a.splice(e,1)};class o{constructor(t,e){b(this,"x");b(this,"y");this.x=t,this.y=e}plus(t){return new o(this.x+t.x,this.y+t.y)}minus(t){return new o(this.x-t.x,this.y-t.y)}multiply(t){return new o(this.x*t,this.y*t)}divide(t){return new o(this.x/t,this.y/t)}half(){return this.multiply(.5)}snap(t){return new o(Math.round(this.x/t)*t,Math.round(this.y/t)*t)}lengthTo(t){return Math.sqrt((this.x-t.x)**2+(this.y-t.y)**2)}isInside(t,e){return t.x<=this.x&&this.x<=t.x+e.x&&t.y<=this.y&&this.y<=t.y+e.y}moveTowards(t,e){return this.plus(this.direction(t).multiply(e))}direction(t){if(t.y===this.y&&t.x===this.x)return new o(0,0);const e=Math.atan2(t.y-this.y,t.x-this.x);return new o(Math.cos(e),Math.sin(e))}round(){return new o(Math.round(this.x),Math.round(this.y))}clamp(t,e){return new o(p(this.x,t.x,e.x),p(this.y,t.y,e.y))}equals(t){return this.x===t.x&&this.y==t.y}copy(){return new o(this.x,this.y)}}const p=(a,t,e)=>Math.max(Math.min(a,e),t);var S;(function(a){a[a.Left=0]="Left",a[a.Middle=1]="Middle",a[a.Right=2]="Right",a[a.BrowserBack=3]="BrowserBack",a[a.BrowserForward=4]="BrowserForward"})(S||(S={}));const x=new Set,y=new Set,w=new Set;document.addEventListener("keydown",a=>{x.add(a.key)});document.addEventListener("keyup",a=>{y.add(a.key)});const G=a=>{const t=new Set,e=new Set,s=new Set,i=(h,_)=>{t.forEach(d=>{s.add(d.button),h.forEach(l=>{l.onMousePress&&l.onMousePress(d,_)})}),t.clear(),e.forEach(d=>{s.delete(d.button),h.forEach(l=>{l.onMouseRelease&&l.onMouseRelease(d,_)})}),e.clear(),x.forEach(d=>{w.add(d),h.forEach(l=>{l.onKeyPress&&l.onKeyPress(d,_)})}),x.clear(),y.forEach(d=>{w.delete(d),h.forEach(l=>{l.onKeyRelease&&l.onKeyRelease(d,_)})}),y.clear()},n={mouse:{canvasPos:new o(0,0),worldPos:new o(0,0),button:h=>s.has(h)},key:h=>w.has(h),__handleInput:i},r=h=>{const _=a.scale??1;return new o((h.pageX-a.element.offsetLeft)/_,(h.pageY-a.element.offsetTop)/_)};document.addEventListener("mousedown",h=>{const _=r(h);t.add({button:h.button,canvasPos:_,worldPos:a.camera?a.camera.toWorldPosition(n.mouse.canvasPos):_})}),document.addEventListener("mouseup",h=>{const _=r(h);e.add({button:h.button,canvasPos:_,worldPos:a.camera?a.camera.toWorldPosition(n.mouse.canvasPos):_})});const c=h=>h.preventDefault();return document.addEventListener("mousemove",h=>{n.mouse.canvasPos=r(h),n.mouse.worldPos=a.camera?a.camera.toWorldPosition(n.mouse.canvasPos):n.mouse.canvasPos;const _=a.scale??1;n.mouse.canvasPos.isInside(new o(0,0),new o(a.element.width/_,a.element.height/_))?document.addEventListener("contextmenu",c):document.removeEventListener("contextmenu",c)}),n};class W{constructor(t){b(this,"__parentElement");b(this,"__canvasElement");b(this,"__ctx");b(this,"__scale",1);b(this,"camera");b(this,"drawImage",(t,e,s,i)=>{const n=Object.assign({imageSmoothingEnabled:!1},i);this.withStyleAndPos(n,r=>{t.image&&this.__ctx.drawImage(t.image,r.x,r.y,t.image.width*(s??1),t.image.height*(s??1))},e)});this.__parentElement=t,this.__canvasElement=document.createElement("canvas"),this.__canvasElement.classList.add("gameCanvas"),this.__parentElement.appendChild(this.__canvasElement),this.__ctx=this.__canvasElement.getContext("2d",{alpha:!1})}__getCameraPositionDelta(){var e,s;if(!((e=this.camera)!=null&&e.target))return new o(0,0);const t=this.camera.target.pos.minus(this.camera.posPrev);return this.camera.posPrev=(s=this.camera.target)==null?void 0:s.pos,t}setOptions(t){this.__canvasElement.width=t.width??this.__canvasElement.width,this.__canvasElement.height=t.height??this.__canvasElement.height,this.__scale=t.scale??this.__scale,t.scale&&this.__ctx.scale(t.scale,t.scale)}get element(){return this.__canvasElement}get scale(){return this.__scale}withStyle(t,e){this.__ctx.save(),t.strokeStyle!==void 0&&(this.__ctx.strokeStyle=t.strokeStyle),t.lineWidth!==void 0&&(this.__ctx.lineWidth=t.lineWidth),t.fillStyle!==void 0&&(this.__ctx.fillStyle=t.fillStyle),(t.font!==void 0||t.fontSize!==void 0)&&(this.__ctx.font=`${t.fontSize??8}px ${t.font??"arial"}`),t.imageSmoothingEnabled!=null&&(this.__ctx.imageSmoothingEnabled=t.imageSmoothingEnabled),e(),this.__ctx.restore()}withStyleAndPos(t,e,s){this.withStyle(t,()=>{this.camera&&!t.gui?e(this.camera.toCanvasPosition(s)):e(s)})}withStyleAndPositions(t,e,s){this.withStyle(t,()=>{this.camera&&!t.gui?e(s.map(i=>this.camera.toCanvasPosition(i))):e(s)})}drawRect(t,e,s){const i=Object.assign({fillStyle:"white"},s);this.withStyleAndPos(i,n=>{this.__ctx.fillStyle&&this.__ctx.fillRect(n.x,n.y,e.x,e.y),this.__ctx.strokeStyle&&this.__ctx.strokeRect(n.x,n.y,e.x,e.y)},t)}drawClear(){this.__ctx.clearRect(0,0,this.__canvasElement.width,this.__canvasElement.height)}drawPath(t,e){const s=Object.assign({strokeStyle:"white",lineWidth:1},e);this.withStyleAndPositions(s,i=>{this.__ctx.beginPath(),this.__ctx.moveTo(i[0].x,i[0].y);for(let n=0;n<i.length;n++)this.__ctx.lineTo(i[n].x,i[n].y);this.__ctx.stroke()},t)}drawLine(t,e,s,i){const n=t.copy(),r=e.copy(),c=Math.atan2(r.y-n.y,r.x-n.x);s.startOffset&&(n.x+=s.startOffset*Math.cos(c),n.y+=s.startOffset*Math.sin(c)),s.endOffset&&(r.x+=s.endOffset*Math.cos(c),r.y+=s.endOffset*Math.sin(c));const h=n.lengthTo(r);s.maxLength&&h>s.maxLength?(r.x=n.x+s.maxLength*Math.cos(c),r.y=n.y+s.maxLength*Math.sin(c)):s.minLength&&h<s.minLength&&(r.x=n.x+s.minLength*Math.cos(c),r.y=n.y+s.minLength*Math.sin(c)),this.drawPath([n,r],i)}drawText(t,e,s){const i=Object.assign({fillStyle:"white",font:"arial",fontSize:8},s);this.withStyleAndPos(i,n=>{this.__ctx.fillText(t,n.x,n.y+(i.fontSize??0))},e)}drawCircle(t,e,s){const i=Object.assign({fillStyle:"white"},s);this.withStyleAndPos(i,n=>{this.__ctx.beginPath(),this.__ctx.arc(n.x,n.y,t,0,2*Math.PI),this.__ctx.closePath(),this.__ctx.fillStyle&&this.__ctx.fill(),this.__ctx.strokeStyle&&this.__ctx.stroke()},e)}}class K{constructor(){b(this,"audioBuffers",new Map);b(this,"__context")}getContext(){return this.__context||(this.__context=new AudioContext),this.__context}async prefetch(t){const e=this.audioBuffers.get(t);if(e)return e;const s=await fetch(t).then(i=>i.arrayBuffer()).then(i=>this.getContext().decodeAudioData(i));return this.audioBuffers.set(t,s),s}async playAudioUrl(t){const e=this.audioBuffers.get(t)??await this.prefetch(t);this.playAudioBuffer(e)}async playAudioBuffer(t){const e=this.getContext(),s=e.createBufferSource();s.buffer=t,s.connect(e.destination),s.start()}}const P={width:480,height:320,scale:2,fps:60,zSort:!0,baseUrl:"./"};class H{constructor(t){b(this,"__gameDiv");b(this,"__assetsDiv");b(this,"__options",P);b(this,"__gameInstances",[]);b(this,"__canvas");b(this,"__t",0);b(this,"__input");b(this,"__currentFps",0);b(this,"__audioStore",new K);b(this,"beforeDraw");b(this,"afterDraw");b(this,"beforeStep");b(this,"afterStep");if(!t)throw new Error("Element passed to Game() is null!");if(!(t instanceof HTMLDivElement))throw new Error("Element passed to Game() is not an HTMLDivElement!");this.__gameDiv=t,this.__canvas=new W(this.__gameDiv),this.__assetsDiv=document.createElement("div"),this.__assetsDiv.hidden=!0,this.__gameDiv.appendChild(this.__assetsDiv),this.setOptions(P),this.__input=G(this.__canvas)}setOptions(t){this.__options={...this.__options,...t};const e=this.getCanvasSize().multiply(this.__options.scale);return this.__canvas.setOptions({width:e.x,height:e.y,scale:this.__options.scale}),this}get options(){return{...this.__options}}get canvas(){return this.__canvas}get currentFps(){return this.__currentFps}getCanvasSize(){return new o(this.__options.width,this.__options.height)}getInstances(t){return t?this.__gameInstances.filter(t):[...this.__gameInstances]}getInstancesOfClass(t){return this.getInstances(e=>e instanceof t)}__addObject(t){this.__gameInstances.push(t)}__removeObject(t){z(this.__gameInstances,t)}__addAssetElement(t){var e;(e=this.__assetsDiv)==null||e.appendChild(t)}play(){let t=0,e=0;const s=i=>{requestAnimationFrame(s);const n=i-t,r=1e3/this.__options.fps;n>=r&&(t=i-n%r,this.__currentFps=1e3/(i-e),e=i,this.__step())};s(0)}__maybeSort(){if(!this.__options.zSort)return;this.__gameInstances.some(e=>e.__changed)&&(this.__gameInstances.sort((e,s)=>e.__zIndex-s.__zIndex),this.__gameInstances.forEach(e=>e.__changed=!1))}getGameContext(){return{game:this,input:this.__input,audio:this.__audioStore,dtFactor:Math.round(this.__options.fps/this.currentFps)}}__step(){var s,i,n,r;const t={game:this,canvas:this.__canvas,input:this.__input,t:this.__t},e=this.getGameContext();this.__input.mouse.worldPos=this.__input.mouse.worldPos.plus(this.__canvas.__getCameraPositionDelta()),this.__maybeSort(),this.__input.__handleInput(this.__gameInstances,e),this.__canvas.drawClear(),(s=this.beforeDraw)==null||s.call(this,t),this.__gameInstances.forEach(c=>{var h;(h=c.draw)==null||h.call(c,t)}),(i=this.afterDraw)==null||i.call(this,t),(n=this.beforeStep)==null||n.call(this,e),this.__gameInstances.forEach(c=>{var h;(h=c.step)==null||h.call(c,e)}),(r=this.afterStep)==null||r.call(this,e),this.__t++}}class J{constructor(){b(this,"__changed",!0);b(this,"__zIndex",0);b(this,"__game");this.activate()}activate(t){var e;return t&&(this.deactivate(),this.__game=t),this.__game?(this.__game.__addObject(this),(e=this.onActivate)==null||e.call(this,this.__game.getGameContext()),this):this}deactivate(){var t;return this.__game?((t=this.onDeactivate)==null||t.call(this,this.__game.getGameContext()),this.__game.__removeObject(this),this):this}destruct(){var t;return this.deactivate(),this.__game?((t=this.onDestruct)==null||t.call(this,this.__game.getGameContext()),this):this}setZIndex(t){return this.__zIndex=t,this.__changed=!0,this}}class v extends J{constructor(e,s){super();b(this,"pos");this.pos=new o(e,s),this.setZIndex(s)}}const I=new Map;class N{}class g extends N{constructor(e,s){super();b(this,"__path");b(this,"__image");this.__path=e,s&&this.__load(s)}__load(e){const s=I.get(this.__path);s instanceof HTMLImageElement&&(this.__image=s);const i=new Image;i.src=this.__path,i.onload=()=>{I.set(this.__path,i),this.__image=i},e.__addAssetElement(i)}size(){var e,s;return new o(((e=this.__image)==null?void 0:e.width)??0,((s=this.__image)==null?void 0:s.height)??0)}get image(){return this.__image}}class M extends v{constructor(){super(...arguments);b(this,"image",A)}}class C extends v{constructor(){super(...arguments);b(this,"image",R)}}class L extends v{constructor(e,s){super(e,s);b(this,"dir",0);b(this,"image",O);b(this,"speed",0);b(this,"rotateSpeed",0);b(this,"rotateAcceleration",4e-4);b(this,"maxRotateSpeed",.025);b(this,"maxSpeed",18);b(this,"acceleration",.5);b(this,"dampRotation",.9);b(this,"dampSpeed",.98)}getInput(e,s){return e.input.key(s)}step(e){for(this.getInput(e,"w")&&this.speed+this.acceleration<this.maxSpeed&&(this.speed+=this.acceleration),this.getInput(e,"s")&&this.speed-this.acceleration>-this.maxSpeed&&(this.speed-=this.acceleration),this.speed*=this.dampSpeed,this.pos.x+=Math.cos(this.dir)*this.speed,this.pos.y+=Math.sin(this.dir)*this.speed,this.getInput(e,"a")&&(this.rotateSpeed-=this.rotateAcceleration),this.getInput(e,"d")&&(this.rotateSpeed+=this.rotateAcceleration),this.rotateSpeed=p(this.rotateSpeed,-this.maxRotateSpeed,this.maxRotateSpeed),(this.rotateSpeed>0&&!this.getInput(e,"d")||this.rotateSpeed<0&&!this.getInput(e,"a"))&&(this.rotateSpeed*=this.dampRotation),this.dir+=this.rotateSpeed;this.dir<-Math.PI;)this.dir+=2*Math.PI;for(;this.dir>Math.PI;)this.dir-=2*Math.PI;const s=k(this.pos,5),i=T(s,this.pos,"",32);i&&(i instanceof M&&(this.speed=0),i instanceof C&&(this.speed*=1.8))}}class U extends L{constructor(e,s){super(e,s);b(this,"target",new o(0,0));this.image=D,this.rotateAcceleration*=10,this.maxRotateSpeed*=2}draw(e){}getInput(e,s){let i=this.dir,n=0;const r=k(this.pos,20);for(const h of[-Math.PI/2,-Math.PI/4,-Math.PI/8,0,Math.PI/8,Math.PI/4,Math.PI/2])for(let _=16;_<=1024;_+=16){const d=this.dir+h,l=new o(this.pos.x+_*Math.cos(d),this.pos.y+_*Math.sin(d)),B=T(r,l,"Barrel",48);if(_>n&&(i=d,n=_),B){d==this.dir&&_<=32&&(this.speed=0);break}}const c=i==this.dir&&n>128;return s=="d"&&i>this.dir||s=="a"&&i<this.dir||s=="w"&&c||s=="s"&&!c&&this.speed>this.acceleration?!0:Math.random()>.95}}const Z=`
  bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb  
 b                                                                            b 
b    c    c     q        c       c        c            c                       b
b                                                                              b
b  c  bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb     b
b    b                                                                    b    b
b   b                                                                      b   b
b c b                                                                      b   b
b   b                                                                      b q b
b c b                                                                      b   b
b   b                                                                      b   b
b c b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b q b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b   b                                                                      b   b
b    b                                                                    b    b
b     bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb     b
b                                                                              b
b                                          q           q           q           b
 b                                                                            b 
  bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb  
`,u=new H(document.querySelector("#app"));u.setOptions({scale:1,height:480,width:800});const O=new g("./sphere.png");O.__load(u);const D=new g("./red_sphere.png");D.__load(u);const A=new g("./barrel.png");A.__load(u);const R=new g("./boost.png");R.__load(u);const f=new L(2*32,10*32),m=[f];Z.split(`
`).forEach((a,t)=>a.split("").forEach((e,s)=>{let i;const n=s*64,r=t*64;switch(e){case"b":i=new M(n,r);break;case"c":i=new U(n,r);break;case"q":i=new C(n,r);break}i&&m.push(i)}));m.forEach(a=>a.activate(u));const E=256,T=(a,t,e="",s=-1)=>{let i=1/0,n=null;for(const r of a){if(r.pos==t||e&&r.constructor.name!=e)continue;const c=r.pos.lengthTo(t);c<i&&(i=c,n=r)}return s==-1||i<s?n:null},k=(a,t)=>m.sort((e,s)=>e.pos.lengthTo(a)-s.pos.lengthTo(a)).slice(0,t);u.beforeDraw=a=>{const t=a.game.getCanvasSize(),e=t.y/5;a.canvas.drawRect(new o(0,0),new o(t.x,t.y),{fillStyle:"green"}),a.canvas.drawRect(new o(0,0),new o(t.x,e+1),{fillStyle:"blue"});const s=f.pos.minus(new o(E*Math.cos(f.dir),E*Math.sin(f.dir)));m.sort((i,n)=>s.lengthTo(n.pos)-s.lengthTo(i.pos)),m.forEach(i=>{let n=Math.atan2(i.pos.y-s.y,i.pos.x-s.x)-f.dir;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;if(!(-Math.PI/2<n&&n<Math.PI/2))return;const r=s.lengthTo(i.pos),c=p(100/Math.pow(r,.8),.01,2.5),h=new o(t.x/2-16,t.y),_=new o(32*Math.pow(r,.4)*Math.cos(n-Math.PI/2),16*Math.pow(r,.35)*Math.sin(n-Math.PI/2));a.canvas.drawImage(i.image,h.plus(_),Math.round(c*100)/100)})};u.play();
